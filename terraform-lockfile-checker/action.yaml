name: sre-actions/terraform-lockfile-checker
description: Check if Terraform lockfile is committed
author: globis-org
inputs:
  pull-request-number:
    description: Pull request number
    required: true
    default: ${{ github.event.pull_request.number }}
  files:
    description: Files to check
    required: true
    default: |
      terraform/**
  files-ignore:
    description: Files to ignore
    required: true
    default: |
      **/modules/**

runs:
  using: composite
  steps:
    - name: Checkout repository
      uses: actions/checkout@08c6903cd8c0fde910a37f88322edcfb5dd907a8 # v5.0.0

    - name: Filter changed files
      id: filter
      uses: tj-actions/changed-files@24d32ffd492484c1d75e0c0b894501ddb9d30d62 # v47.0.0
      with:
        json: true
        write_output_files: true
        dir_names: true
        files: ${{ inputs.files }}
        files_ignore: ${{ inputs.files-ignore }}

    - name: Check .terraform.lock.hcl is committed
      run: ${{ github.action_path }}/check.sh
      shell: bash
      env:
        GH_TOKEN: ${{ github.token }}
        PR_NUMBER: ${{ inputs.pull-request-number }}
        JSON_PATH: .github/outputs/all_changed_and_modified_files.json
      if: steps.filter.outputs.all_changed_and_modified_files_count != '0' && github.event_name == 'pull_request'
